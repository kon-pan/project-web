<%- include('partials/head.ejs')  %> 
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css"
      integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA=="
      crossorigin="anonymous"
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet-src.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="static/css/user/style.css" />

    <title>HARτης | Welcome</title>
  </head>
  <body>
    <%- include('partials/navbar.ejs')  %> 
    <div class="container mt-3">
      <div class="row justify-content-center">
        <div class="col-auto p-3" id="map-wrapper">
          <div id="map"></div>
          <div class="row mt-4">
            <div class="col">
              <form action="" class="form-inline">
                <div class="form-check mb-2 mr-sm-2">
                  <span class="px-3"><b>Filter by content type:</b></span>
                  <div
                    class="custom-control custom-radio custom-control-inline"
                  >
                    <input
                      type="radio"
                      id="customRadioInline1"
                      name="customRadioInline1"
                      class="custom-control-input"
                    />
                    <label class="custom-control-label" for="customRadioInline1"
                      >Value 1</label
                    >
                  </div>
                  <div
                    class="custom-control custom-radio custom-control-inline"
                  >
                    <input
                      type="radio"
                      id="customRadioInline2"
                      name="customRadioInline1"
                      class="custom-control-input"
                    />
                    <label class="custom-control-label" for="customRadioInline2"
                      >Value 2</label
                    >
                  </div>
                  <div
                    class="custom-control custom-radio custom-control-inline"
                  >
                    <input
                      type="radio"
                      id="customRadioInline2"
                      name="customRadioInline1"
                      class="custom-control-input"
                    />
                    <label class="custom-control-label" for="customRadioInline2"
                      >Value 3</label
                    >
                  </div>
                  <div
                    class="custom-control custom-radio custom-control-inline"
                  >
                    <input
                      type="radio"
                      id="customRadioInline2"
                      name="customRadioInline1"
                      class="custom-control-input"
                    />
                    <label class="custom-control-label" for="customRadioInline2"
                      >Value 4</label
                    >
                  </div>
                  <div
                    class="custom-control custom-radio custom-control-inline"
                  >
                    <input
                      type="radio"
                      id="customRadioInline2"
                      name="customRadioInline1"
                      class="custom-control-input"
                    />
                    <label class="custom-control-label" for="customRadioInline2"
                      >Value 5</label
                    >
                  </div>
                  <button class="btn btn-primary btn-sm" type="submit">
                    Apply
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>
    <!-- Leaflet Heatmap -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.min.js"
      integrity="sha512-FpvmtV53P/z7yzv1TAIVH7PNz94EKXs5aV6ts/Zi+B/VeGU5Xwo6KIbwpTgKc0d4urD/BtkK50IC9785y68/AA=="
      crossorigin="anonymous"
    ></script>
    <script src="/js/user/leaflet-heatmap.js"></script>
    <!-- My scripts -->
    <script>
      const getHeatMapData = async () => {
        let data = await fetch(`http://${location.host}/heatmap/getData`);
        data = await data.json();
        data = JSON.parse(data);
        console.log(data);
        let heatMapData = [];
        for (let elem of data) {
          if (!(elem.server_lat === null || elem.server_lon === null)) {
            heatMapData.push({
              lat: elem.server_lat,
              lng: elem.server_lon,
              count: elem.count,
            });
          }
        }
        console.log(heatMapData);
        createHeatMap(heatMapData);
      };

      const createHeatMap = (heatMapData) => {
        var baseLayer = L.tileLayer(
          'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          {
            attribution: 'HARτες',
            maxZoom: 18,
          }
        );

        // var cfg = {
        //   // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        //   // if scaleRadius is false it will be the constant radius used in pixels
        //   radius: 2,
        //   maxOpacity: 0.8,
        //   // scales the radius based on map zoom
        //   scaleRadius: true,
        //   // if set to false the heatmap uses the global maximum for colorization
        //   // if activated: uses the data maximum within the current map boundaries
        //   //   (there will always be a red spot with useLocalExtremas true)
        //   useLocalExtrema: true,
        //   // which field name in your data represents the latitude - default "lat"
        //   latField: 'lat',
        //   // which field name in your data represents the longitude - default "lng"
        //   lngField: 'lng',
        //   // which field name in your data represents the data value - default "value"
        //   valueField: 'count',
        // };
        var cfg = {
          radius: 15,
          maxOpacity: 0.5,
          minOpacity: 0,
          blur: 0.75,
        };

        var testData = {
          max: 10,
          data: heatMapData,
        };

        var heatmapLayer = new HeatmapOverlay(cfg);

        var map = new L.Map('map', {
          center: new L.LatLng(0, 0),
          zoom: 1,
          layers: [baseLayer, heatmapLayer],
        });

        heatmapLayer.setData(testData);
      };

      getHeatMapData();
    </script>
  </body>
</html>
